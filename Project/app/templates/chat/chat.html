{% extends "chat/base.html" %}
{% block chatbox %}
<div class="max-w-md mx-auto mt-10 bg-white shadow-lg rounded-xl flex flex-col h-[500px]">
    <!-- Header -->
    <div class="bg-blue-600 text-white px-4 py-3 rounded-t-xl">
      <h2 class="text-lg font-semibold">{{ chat_room_name }}</h2>
    </div>
  
    <!-- Chat Messages -->
    <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-2 bg-gray-50">
      <!-- Example Messages -->
      {% for message in chat_messages %}
      {% include 'chat/chat_message.html'%}
      {% endfor %}
    </div>
  
    <!-- Input -->
    <form action="#"  class="px-4 py-3 border-t border-gray-200 flex gap-2"
    hx-post = "{% url 'joinChat' %}"
    hx-target="#chat-messages"
    hx-swap="beforeend">
       {% csrf_token %}
       {{ form }}
       <button 
        type="submit" 
        class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition"
      >
        Send
      </button> 
    </form>
  </div>
  {% endblock %}

{% block script %}
<script>

  function scrollToBottom() {
    const chatMessages = document.getElementById("chat-messages");
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  document.addEventListener("DOMContentLoaded", scrollToBottom);

  document.body.addEventListener("htmx:afterSwap", (e) => {
    if (e.target.id === "chat-messages") {
      scrollToBottom();
    }
  });

  document.body.addEventListener("htmx:afterRequest", function (event) {
    const form = document.querySelector("form[hx-post]");
    if (form) {
      const input = form.querySelector("input[name='message']"); // adjust name if different
      if (input) {
        input.value = "";
      }
    }
  });

</script>

{% endblock %}